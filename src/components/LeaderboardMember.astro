---
// © 2024 Vlad-Stefan Harbuz <vlad@vlad.website>
// SPDX-License-Identifier: Apache-2.0

interface Props {
  member: MemberWithId;
}

const { member } = Astro.props;

import dayjs from 'dayjs';

import { getDollarsPerDev, fmtCurrency } from '../memberFormatting.ts';
import type { MemberWithId } from "../schemas/members.ts";
import type { Map } from '../util.ts';
import memberRoles from "../memberRoles.json"

const memberRole = (memberRoles as Map)[member.id];
const memberJoinDate = dayjs(member.data.joinDate).format('DD MMM YYYY');
const memberNDevs = member.data.annualReports[0].averageNumberOfDevs;
const memberDollarsPerDev = fmtCurrency(getDollarsPerDev(member.data.annualReports[0]));
---

<a class="member sneaky" href={`/members/${member.id}`}>
  <div class="main">
    <img src=`/images/members/${member.id}/logo.webp` alt=`The ${member.data.name} logo`>
    <div class="metadata">
      <h2>{member.data.name}</h2>
      <span>{memberRole} since {memberJoinDate}</span>
      <div class="numbers">
        <span>{memberNDevs} dev{memberNDevs != 1 && 's'}</span>
        <span>{memberDollarsPerDev} / dev</span>
      </div>
    </div>
  </div>
  <em>“{member.data.shortDescription}”</em>
</a>

<style>
  a.member {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin: 0;
    padding: 1rem;
    background-color: var(--color-light-bg);
    border: 3px solid transparent;
    border-radius: 0.5rem;
    font-size: smaller;
    @media (max-width: 450px) {
      padding: 0.5rem;
    }
    &:hover {
      border: 3px solid var(--color-secondary);
      text-decoration: none;
    }
    .main {
      display: flex;
      gap: 1rem;
      img {
        align-self: center;
        max-width: 4.5rem;
        @media (max-width: 450px) {
          max-width: 3.0rem;
        }
      }
      .metadata {
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 0.2rem;
        .numbers {
          display: flex;
          justify-content: space-between;
        }
        h2 {
          margin: 0;
          font-size: 1.2rem;
          line-height: 1.3;
        }
      }
    }
  }
</style>
